#!/usr/bin/env python3
"""
AI Slide Generator - CLI App

This is the main entry point for the AI Slide Generator application.
It provides a command-line interface for generating and refining presentation slides.
"""

import os
import json
import logging
import argparse
import sys
import datetime
import time
import webbrowser
from pathlib import Path
from typing import Dict, List, Optional, Any, Union
import re

from dotenv import load_dotenv
from agents.slide_writer.slide_template import SlideTemplate

# Import agents
from agents import (
    search_deep,
    generate_outline,
    generate_slides,
    fetch_image,
    refine_presentation,
    select_template_for_presentation,
    monitor_research_and_outline,
    monitor_slides_and_refine,
    orchestrate_slide_generation
)

# For URL content summarization
import requests
from bs4 import BeautifulSoup
from concurrent.futures import ThreadPoolExecutor, as_completed

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨
class AgentDataStore:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢"""
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super(AgentDataStore, cls).__new__(cls)
            cls._instance._data = {}
        return cls._instance
    
    def set(self, key: str, value: Any) -> None:
        """ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜"""
        self._data[key] = value
    
    def get(self, key: str, default: Any = None) -> Any:
        """ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—"""
        return self._data.get(key, default)
    
    def clear(self) -> None:
        """å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢"""
        self._data.clear()
    
    def save_to_file(self, file_path: str) -> None:
        """ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜"""
        try:
            with open(file_path, 'w', encoding='utf-8') as f:
                json.dump(self._data, f, ensure_ascii=False, indent=2)
        except Exception as e:
            logging.getLogger(__name__).error(f"ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
    
    def load_from_file(self, file_path: str) -> bool:
        """JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                self._data = json.load(f)
            return True
        except Exception as e:
            logging.getLogger(__name__).error(f"ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
            return False

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
agent_data_store = AgentDataStore()

# Create logs directory if it doesn't exist
logs_dir = Path("logs")
logs_dir.mkdir(exist_ok=True)

# Configure logging
def setup_logging(topic=None):
    """Configure logging with both console and file handlers."""
    # Clear existing handlers
    logger = logging.getLogger()
    for handler in logger.handlers[:]:
        logger.removeHandler(handler)
    
    # Create a timestamp for the log file
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    if topic:
        # Sanitize topic for filename
        safe_topic = "".join(c if c.isalnum() else "_" for c in topic)
        safe_topic = safe_topic[:30]  # Limit length
        log_filename = f"{timestamp}_{safe_topic}.log"
    else:
        log_filename = f"{timestamp}_ai_slide_generator.log"
    
    log_file = logs_dir / log_filename
    
    # Set up file handler for detailed logs
    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    file_handler.setLevel(logging.DEBUG)
    file_format = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    file_handler.setFormatter(file_format)
    
    # Set up console handler for simplified logs
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    # Simpler format for console - only show the message, no timestamps or levels
    console_format = logging.Formatter('%(message)s')
    console_handler.setFormatter(console_format)
    
    # Filter to prevent specific messages from showing in console
    class ConsoleFilter(logging.Filter):
        def __init__(self):
            super().__init__()
            self.last_error_message = None
            self.last_error_base = None
            
        def filter(self, record):
            # Filter out HTTP request logs from console output
            message = record.getMessage()
            if any(pattern in message for pattern in [
                "HTTP Request:", 
                "Retrying request to", 
                "Error code: 429"
            ]):
                return False
                
            # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é‡è¤‡é˜²æ­¢ã¨ã‚·ãƒ³ãƒ—ãƒ«åŒ–
            if "âŒ" in message:
                # ã‚³ãƒ­ãƒ³ãŒã‚ã‚‹å ´åˆã¯è©³ç´°æƒ…å ±ã‚’çœç•¥ã—ã¦ç°¡æ½”ã«è¡¨ç¤º
                base_message = message
                if ":" in message:
                    base_message = message.split(":", 1)[0]
                
                # åŒã˜ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é‡è¤‡ã‚’é˜²æ­¢ï¼ˆè©³ç´°ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ç°¡ç•¥åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãŒåŒã˜å ´åˆï¼‰
                if message == self.last_error_message or base_message == self.last_error_base:
                    return False
                    
                # ä¸¡æ–¹ã‚’è¨˜æ†¶ã—ã¦æ¬¡å›æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
                self.last_error_message = message
                self.last_error_base = base_message
                
                # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯è©³ç´°ã‚’è¨˜éŒ²ã—ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¯ç°¡æ½”ã«è¡¨ç¤º
                record.original_message = message
                record.msg = base_message
            
            return True
    
    console_handler.addFilter(ConsoleFilter())
    
    # Configure root logger
    logger.setLevel(logging.DEBUG)
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return log_file

def generate_slides_cli(topic: str, slide_count: int = 5, style: str = "professional", depth: str = "low", output_file: str = None, use_orchestrator: bool = False) -> str:
    """
    Generate slides from the command line interface
    
    Args:
        topic: The presentation topic
        slide_count: Number of slides to generate
        style: Presentation style
        depth: Search depth (low/medium/high)
        output_file: Optional file path to save the HTML
        use_orchestrator: Whether to use the orchestrator agent
        
    Returns:
        HTML content of the generated slides
    """
    # Set up logging for this CLI session
    log_file = setup_logging(topic)
    logger = logging.getLogger(__name__)
    
    # Initialize result storage
    research_results = None
    outline = None
    slide_theme = None
    html_content = None
    
    try:
        # Define line separator for readability
        separator_line = "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        print(separator_line)
        
        print(f"ğŸ“ ç”Ÿæˆãƒˆãƒ”ãƒƒã‚¯: {topic}")
        print(f"ğŸ“Š æ¤œç´¢æ·±åº¦: {depth}")
        if use_orchestrator:
            print(f"ğŸ§  å¸ä»¤å¡”ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨: æœ‰åŠ¹")
        print()
        print(separator_line)
        
        if use_orchestrator:
            # Use the comprehensive orchestrator agent that manages the entire process
            print("\nğŸ§  å¸ä»¤å¡”ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™...")
            try:
                # Execute using orchestrator
                html_content, generation_report = orchestrate_slide_generation(
                    topic=topic, 
                    slide_count=slide_count,
                    style=style,
                    depth=depth
                )
                
                # Display QA summary from the report
                qa_summary = generation_report.get("qa_summary", "No QA summary available")
                print(f"\nğŸ“‹ QAçµæœ: {qa_summary}")
                
                # Show any special notes from the orchestration process
                if "notes" in generation_report and generation_report["notes"]:
                    print("\nğŸ“Œ å¸ä»¤å¡”ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®æ³¨æ„ç‚¹:")
                    for note in generation_report["notes"]:
                        print(f"  â€¢ {note}")
                
            except Exception as e:
                logger.error(f"âŒ å¸ä»¤å¡”ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼: {str(e)}")
                print("â„¹ï¸ æ¨™æº–çš„ãªã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™")
                # Fall back to the standard process
                use_orchestrator = False
        
        if not use_orchestrator:
            # Standard step-by-step process
            # Step 1 & 2: Research the topic and generate outline using monitor agent
            print("\nğŸ” ãƒªã‚µãƒ¼ãƒãŠã‚ˆã³ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ä½œæˆ: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...")
            try:
                logger.info(f"Starting research and outline phase with monitoring for: {topic}")
                research_results, outline = monitor_research_and_outline(topic, slide_count, depth)
            except Exception as e:
                logger.error(f"âŒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼: {str(e)}")
                print("â„¹ï¸ åŸºæœ¬çš„ãªãƒªã‚µãƒ¼ãƒã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã§ç¶šè¡Œã—ã¾ã™")
                
                # Fallback to direct research and outline
                try:
                    from agents.research import ResearchAgent
                    research_agent = ResearchAgent()
                    research_results = research_agent.search_deep(topic, depth)
                    
                    from agents.outline import generate_outline
                    outline = generate_outline(research_results, slide_count)
                except Exception as fallback_error:
                    logger.error(f"âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã«ã‚‚å¤±æ•—ã—ã¾ã—ãŸ: {str(fallback_error)}")
            
            print(f"âœ… {slide_count} ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸ")
            
            print()
            print(separator_line)
            
            # Step 3: Select appropriate template
            print("\nğŸ¨ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: æœ€é©ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
            print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
            from agents.template_selector import select_template_for_presentation
            slide_theme = select_template_for_presentation(topic, outline, style)
            print(f"âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ{slide_theme.name}ã€ã‚’é¸æŠã—ã¾ã—ãŸ")
            
            print()
            print(separator_line)
            
            # Step 4 & 5: Generate slides and refine with monitoring
            print("\nğŸ“Š ã‚¹ãƒ©ã‚¤ãƒ‰ç”ŸæˆãŠã‚ˆã³æ”¹å–„: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹åå¾©çš„ãªå‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...")
            
            # Describe the slide generation process
            print()
            print("ğŸ”„ ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã¨æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹:")
            print("  1. ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’åŸºã«ã‚¹ãƒ©ã‚¤ãƒ‰ã®HTMLã‚’ç”Ÿæˆ")
            print("  2. å„ã‚¹ãƒ©ã‚¤ãƒ‰æ¯ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ (å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã§åŒã˜ãƒ†ãƒ¼ãƒã‚’ä½¿ç”¨)")
            print("  3. ã‚¹ãƒ©ã‚¤ãƒ‰ã”ã¨ã«å€‹åˆ¥HTMLã‚’ç”Ÿæˆå¾Œã€1ã¤ã®HTMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«çµ±åˆ")
            print("  4. ã‚¹ãƒ©ã‚¤ãƒ‰æ”¹å–„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚Šå†…å®¹ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è©•ä¾¡ãƒ»æ”¹è‰¯")
            
            try:
                refined_html, qa_report = monitor_slides_and_refine(outline, slide_theme)
                html_content = refined_html
            except Exception as e:
                logger.error(f"âŒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ä»˜ãã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                print("â„¹ï¸ åŸºæœ¬çš„ãªã‚¹ãƒ©ã‚¤ãƒ‰ç”ŸæˆãŠã‚ˆã³æ”¹å–„ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™")
                
                # Fall back to basic slides generation and refinement
                try:
                    slides_html = generate_slides(outline, theme=slide_theme, style=style)
                    refined_html, qa_report = refine_presentation(slides_html)
                    html_content = refined_html
                except Exception as fallback_error:
                    logger.error(f"âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã«ã‚‚å¤±æ•—ã—ã¾ã—ãŸ: {str(fallback_error)}")
                    raise  # Propagate error after logging
                    
            # Log completion
            print()
            print("âœ… ã‚¹ãƒ©ã‚¤ãƒ‰æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸ")
            print(f"  æœ€çµ‚å‡ºåŠ›: å˜ä¸€ã®HTMLæ–‡æ›¸ ({len(html_content) // 1024}KB)")
            print("âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç”Ÿæˆã¨åå¾©çš„ãªå“è³ªæ”¹å–„ãŒå®Œäº†ã—ã¾ã—ãŸ")
            
            print()
            print(f"ğŸ“‹ QAçµæœ: {qa_report.get('summary', 'No QA summary available')}")
            print(separator_line)
        
        # Save the output if a file is specified
        if output_file:
            # Generate the output filename if it's a directory
            output_path = Path(output_file)
            if output_path.is_dir():
                # Use the topic as the filename
                safe_topic = "".join(c if c.isalnum() else "_" for c in topic)
                output_path = output_path / f"{safe_topic}.html"
            
            # Ensure the directory exists
            output_path.parent.mkdir(parents=True, exist_ok=True)
            
            # Write the HTML content to the file
            with open(output_path, 'w', encoding='utf-8') as f:
                f.write(html_content)
            
            print(f"ğŸ’¾ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä¿å­˜ã—ã¾ã—ãŸ: {output_path}")
        
        # Output to the console
        print(f"ç”Ÿæˆãƒ­ã‚°: {log_file}")
        
        return html_content
        
    except Exception as e:
        logger.error(f"âŒ ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
        raise

def generate_slides_from_json(json_file: str, slide_count: int = 5, style: str = "professional", output_file: str = None, open_in_browser: bool = False) -> str:
    """
    Generate slides directly from a JSON file containing research results.
    
    Args:
        json_file: Path to the JSON file with research data
        slide_count: Number of slides to generate
        style: Presentation style
        output_file: Optional file path to save the HTML
        open_in_browser: Whether to open the generated slides in a browser
        
    Returns:
        HTML content of the generated slides
    """
    # Set up logging
    log_file = setup_logging(os.path.basename(json_file))
    logger = logging.getLogger(__name__)
    
    try:
        # Load the JSON file
        logger.info(f"Loading research data from: {json_file}")
        with open(json_file, 'r', encoding='utf-8') as f:
            research_data = json.load(f)
        
        # Display basic info
        separator_line = "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        topic = research_data.get("topic", "Unknown Topic")
        print(separator_line)
        print(f"ğŸ“ JSONå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«: {json_file}")
        print(f"ğŸ“Š ãƒˆãƒ”ãƒƒã‚¯: {topic}")
        print(f"ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒ«: {style}")
        print(f"ğŸ“Š ã‚¹ãƒ©ã‚¤ãƒ‰æ•°: {slide_count}")
        print(separator_line)
        
        # Step 1: Generate outline from research data
        print("\nğŸ“ JSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
        from agents.outline import generate_outline
        outline = generate_outline(research_data, slide_count, topic)
        print(f"âœ… {len(outline.slides)} ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸ")
        
        print()
        print(separator_line)
        
        # Step 2: Select appropriate template
        print("\nğŸ¨ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: æœ€é©ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
        from agents.template_selector import select_template_for_presentation
        slide_theme = select_template_for_presentation(topic, outline, style)
        print(f"âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ{slide_theme.name}ã€ã‚’é¸æŠã—ã¾ã—ãŸ")
        
        print()
        print(separator_line)
        
        # Step 3: Create individual slide HTML files and then combine them
        print("\nğŸ“Š å„ã‚¹ãƒ©ã‚¤ãƒ‰ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­...")
        
        # Create output directory for individual slides
        timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        safe_topic = "".join(c if c.isalnum() else "_" for c in topic)[:30]
        slides_dir = os.path.join(OUTPUT_DIR, f"{timestamp}_{safe_topic}")
        os.makedirs(slides_dir, exist_ok=True)
        
        # Create SlideWriter instance
        from agents.slide_writer import SlideWriterAgent
        slide_writer = SlideWriterAgent()
        
        # List to store individual slide paths
        slide_files = []
        
        # Generate each slide as a separate HTML file
        for i, slide in enumerate(outline.slides):
            slide_num = i + 1
            print(f"\nğŸ”„ ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}/{len(outline.slides)} ç”Ÿæˆä¸­: ã€Œ{slide.title}ã€")
            print(f"  ã‚¿ã‚¤ãƒ—: {slide.type}")
            print(f"  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„:")
            for bullet in slide.content:
                print(f"    â€¢ {bullet}")
                
            # Generate individual slide HTML
            slide_html = create_individual_slide_html(slide, slide_theme, slide_num, len(outline.slides))
            
            # Save individual slide to file
            slide_filename = f"slide_{slide_num:02d}.html"
            slide_path = os.path.join(slides_dir, slide_filename)
            with open(slide_path, 'w', encoding='utf-8') as f:
                f.write(slide_html)
                
            slide_files.append(slide_path)
            print(f"âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num} ãŒç”Ÿæˆã•ã‚Œã€ä¿å­˜ã•ã‚Œã¾ã—ãŸ: {slide_filename}")
        
        # Create the main slideshow HTML that combines all individual slides
        print("\nğŸ”„ å€‹åˆ¥ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’çµ±åˆã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’ç”Ÿæˆä¸­...")
        slideshow_html = create_index_html(slide_files, topic, slide_theme, slides_dir)
        
        # Define the output path for the combined slideshow
        if output_file:
            # Generate the output filename if it's a directory
            output_path = Path(output_file)
            if output_path.is_dir():
                # Use the topic as the filename
                safe_topic = "".join(c if c.isalnum() else "_" for c in topic)
                output_path = output_path / f"{safe_topic}.html"
        else:
            # Default output path
            output_path = os.path.join(slides_dir, f"{safe_topic}_slideshow.html")
            
        # Save the slideshow HTML
        with open(output_path, 'w', encoding='utf-8') as f:
            f.write(slideshow_html)
            
        print(f"âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ: {output_path}")
        
        # Open in browser if requested
        if open_in_browser:
            print(f"ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’é–‹ã„ã¦ã„ã¾ã™...")
            try:
                webbrowser.open(output_path.absolute().as_uri())
                print(f"âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™")
            except Exception as e:
                print(f"âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                print(f"â„¹ï¸ æ‰‹å‹•ã§æ¬¡ã®URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«å…¥åŠ›ã—ã¦ãã ã•ã„: {output_path.absolute().as_uri()}")
        
        # Output to the console
        print(f"ç”Ÿæˆãƒ­ã‚°: {log_file}")
        
        return slideshow_html
        
    except Exception as e:
        logger.error(f"âŒ JSONã‹ã‚‰ã®ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
        raise

def create_individual_slide_html(slide, theme, slide_num, total_slides):
    """
    Create HTML for an individual slide.
    
    Args:
        slide: The slide content
        theme: The slide theme
        slide_num: The slide number
        total_slides: Total number of slides
        
    Returns:
        HTML for the individual slide
    """
    try:
        slide_type = slide.type.lower() if hasattr(slide, 'type') else "content"
        slide_title = slide.title if hasattr(slide, 'title') and slide.title else f"ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}"
        slide_content = slide.content if hasattr(slide, 'content') and slide.content else []
        
        # Add additional theme CSS variables
        css_variables = {
            "--primary-color": theme.primary_color,
            "--secondary-color": theme.secondary_color,
            "--text-color": theme.text_color,
            "--background-color": theme.background_color,
            "--accent-color": getattr(theme, "accent_color", "#F59E0B"),
            "--font-family": theme.font_family,
            "--slide-index": str(slide_num),
            "--total-slides": str(total_slides),
        }
        
        # Add heading font if available
        if hasattr(theme, "heading_font") and theme.heading_font:
            css_variables["--heading-font"] = theme.heading_font
        else:
            css_variables["--heading-font"] = theme.font_family
            
        # Add code font if available
        if hasattr(theme, "code_font") and theme.code_font:
            css_variables["--code-font"] = theme.code_font
        
        # Generate CSS variables string
        css_vars = "\n        ".join([f"{key}: {value};" for key, value in css_variables.items()])
        
        # Choose bullet style based on theme setting or default to circle
        bullet_style = "fa-circle"
        if hasattr(theme, "bullet_style"):
            if theme.bullet_style == "square":
                bullet_style = "fa-square"
            elif theme.bullet_style == "dash":
                bullet_style = "fa-minus"
            elif theme.bullet_style == "arrow":
                bullet_style = "fa-chevron-right"
                
        # Choose header style based on theme
        header_style_class = "gradient-header"
        if hasattr(theme, "header_style"):
            if theme.header_style == "solid":
                header_style_class = "solid-header"
            elif theme.header_style == "minimal":
                header_style_class = "minimal-header"
            elif theme.header_style == "none":
                header_style_class = "no-header"
        
        # Create base HTML structure for an individual slide
        html = f"""<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num} - {slide_title}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {{
            {css_vars}
        }}
        
        body {{
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
        }}
        
        /* External navigation bar */
        .external-nav {{
            width: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 0.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }}
        
        .index-button {{
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: opacity 0.2s;
        }}
        
        .index-button:hover {{
            opacity: 0.9;
        }}
        
        /* Hide external nav in slideshow mode */
        body.in-slideshow .external-nav {{
            display: none;
        }}
        
        .slide {{
            width: 90%;
            max-width: 1000px;
            height: auto;
            min-height: 70vh;
            padding: 2rem 3rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
        }}
        
        /* Text density styles */
        .text-density-minimal .content ul li {{
            margin-bottom: 2rem;
            font-size: 1.4rem;
        }}
        
        .text-density-balanced .content ul li {{
            margin-bottom: 1.2rem;
            font-size: 1.2rem;
        }}
        
        .text-density-detailed .content ul li {{
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }}
        
        h1, h2 {{
            font-family: var(--heading-font, var(--font-family));
            color: var(--primary-color);
            margin-bottom: 2rem;
        }}
        
        h1 {{
            font-size: 3.5rem;
            font-weight: 700;
        }}
        
        h2 {{
            font-size: 2.5rem;
            font-weight: 600;
        }}
        
        .title-slide {{
            text-align: center;
            align-items: center;
            justify-content: center;
        }}
        
        .subtitle {{
            font-size: 1.8rem;
            margin-bottom: 2rem;
            opacity: 0.8;
        }}
        
        /* Header Styles */
        .gradient-header {{
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            padding: 1.5rem;
            margin: -2rem -3rem 2rem -3rem;
            border-radius: 8px 8px 0 0;
        }}
        
        .gradient-header h2 {{
            color: white;
            margin-bottom: 0;
        }}
        
        .solid-header {{
            background-color: var(--primary-color);
            padding: 1.5rem;
            margin: -2rem -3rem 2rem -3rem;
            border-radius: 8px 8px 0 0;
        }}
        
        .solid-header h2 {{
            color: white;
            margin-bottom: 0;
        }}
        
        .minimal-header {{
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }}
        
        .no-header {{
            margin-bottom: 2rem;
        }}
        
        /* Content Styles */
        .slide-content {{
            width: 100%;
            flex: 1;
        }}
        
        .bullet-list {{
            list-style: none;
            padding: 0;
            margin: 1rem 0;
            width: 100%;
        }}
        
        .bullet-item {{
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }}
        
        .bullet-icon {{
            color: var(--secondary-color);
            margin-right: 1rem;
            font-size: 0.8em;
            min-width: 1em;
        }}
        
        .bullet-content {{
            flex: 1;
        }}
        
        .slide-footer {{
            margin-top: auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            opacity: 0.7;
            padding-top: 2rem;
        }}
    </style>
</head>
<body>
    <div class="external-nav">
        <a href="index.html" class="index-button">
            <i class="fas fa-home"></i> ç›®æ¬¡ã«æˆ»ã‚‹
        </a>
        <span class="slide-info">ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}/{total_slides}</span>
    </div>"""
        
        # Add content based on slide type
        if slide_type == "title":
            html += f"""
    <div class="slide title-slide">
        <h1>{slide_title}</h1>"""
            
            if hasattr(slide, 'subtitle') and slide.subtitle:
                html += f"""
        <div class="subtitle">{slide.subtitle}</div>"""
            
            if slide_content:
                html += """
        <div class="content">
            <ul class="bullet-list">"""
                
                for point in slide_content:
                    html += f"""
                <li class="bullet-item">
                    <span>{point}</span>
                </li>"""
                
                html += """
            </ul>
        </div>"""
            
            html += f"""
        <div class="slide-footer">
            <span>ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}/{total_slides}</span>
        </div>
    </div>
</body>
</html>"""
        
        elif slide_type == "content":
            html += f"""
    <div class="slide content-slide">
        <div class="{header_style_class}">
            <h2>{slide_title}</h2>
        </div>
        <div class="slide-content">
            <ul class="bullet-list">"""
            
            for point in slide_content:
                html += f"""
                <li class="bullet-item">
                    <i class="bullet-icon fas {bullet_style}"></i>
                    <div class="bullet-content">
                        <span>{point}</span>
                    </div>
                </li>"""
            
            html += f"""
            </ul>
        </div>
        <div class="slide-footer">
            <span>ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}/{total_slides}</span>
        </div>
    </div>
</body>
</html>"""
        
        # For other slide types, use content slide as default
        else:
            html += f"""
    <div class="slide content-slide">
        <div class="{header_style_class}">
            <h2>{slide_title}</h2>
        </div>
        <div class="slide-content">
            <ul class="bullet-list">"""
            
            for point in slide_content:
                html += f"""
                <li class="bullet-item">
                    <i class="bullet-icon fas {bullet_style}"></i>
                    <div class="bullet-content">
                        <span>{point}</span>
                    </div>
                </li>"""
            
            html += f"""
            </ul>
        </div>
        <div class="slide-footer">
            <span>ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num}/{total_slides}</span>
        </div>
    </div>
</body>
</html>"""
        
        return html
        
    except Exception as e:
        logging.error(f"Error generating individual slide HTML: {str(e)}")
        # Return a simple fallback slide
        return f"""<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ©ã‚¤ãƒ‰ {slide_num} - ã‚¨ãƒ©ãƒ¼</title>
    <style>
        body {{ font-family: sans-serif; padding: 2rem; }}
        .error {{ color: red; }}
    </style>
</head>
<body>
    <h1>ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</h1>
    <p class="error">{str(e)}</p>
    <p><a href="index.html">ç›®æ¬¡ã«æˆ»ã‚‹</a></p>
</body>
</html>"""

def parse_args():
    """Parse command line arguments"""
    # Create the top-level parser
    description = """AI Slide Generator - Automatically generate presentation slides from topics

This tool uses AI to automatically research topics, create outlines,
and generate slides. Select search depth (low/medium/high)
to balance between generation speed and information detail.

The system uses OpenAI's web search API to gather accurate information for slides.
        """
    
    epilog = """Examples:
  # Generate 5 slides (low depth)
  python app.py slide "AI Basics" --slides 5
  
  # Generate with detailed research and open in browser
  python app.py slide "Machine Learning" --depth high --open
  
  # Basic search functionality without detailed analysis
  python app.py research "AI and Machine Learning" --basic --results 10
  
  # Perform detailed research and save to JSON
  python app.py research "Quantum Computing" --depth high --output research.json
  
  # Generate slides from a JSON file
  python app.py json-to-slides research.json --slides 5 --open
        """
    
    parser = argparse.ArgumentParser(description=description, epilog=epilog,
                                    formatter_class=argparse.RawDescriptionHelpFormatter)
    
    # Create subparsers for different commands
    subparsers = parser.add_subparsers(dest='command', help='Command to run', title='Available commands')
    
    # Slide generation command
    slide_parser = subparsers.add_parser('slide', help='Generate presentation slides from a topic')
    slide_parser.add_argument('topic', help='The topic to generate slides about')
    slide_parser.add_argument('--slides', '-s', type=int, default=5, help='Number of slides to generate (default: 5)')
    slide_parser.add_argument('--style', type=str, default='professional', 
                             choices=['professional', 'modern', 'minimal', 'business'],
                             help='Presentation style (default: professional)')
    slide_parser.add_argument('--depth', '-d', type=str, default='low', 
                            choices=['low', 'medium', 'high'],
                            help='Research depth - affects generation time and detail (default: low)')
    slide_parser.add_argument('--output', '-o', type=str, 
                            help='Output HTML file or directory (default: temporary file)')
    slide_parser.add_argument('--open', '-b', action='store_true', 
                            help='Open the generated slides in a browser')
    slide_parser.add_argument('--orchestrator', action='store_true',
                            help='Use the comprehensive orchestrator agent to manage the entire process')
    
    # Add quality check arguments
    slide_parser.add_argument('--quality-check', action='store_true',
                              help='Enable quality check and improvement features')
    slide_parser.add_argument('--min-quality', type=int, default=70,
                              help='Minimum quality score (0-100) required to pass quality check (default: 70)')
    slide_parser.add_argument('--quality-report', action='store_true',
                              help='Generate and display detailed quality report')
    slide_parser.add_argument('--focus-metrics', type=str,
                              help='Comma-separated list of metrics to focus on during quality check (e.g., "content,accuracy")')
    slide_parser.add_argument('--text-density', type=str, default='balanced',
                              choices=['minimal', 'balanced', 'detailed'],
                              help='Expected text density for content richness evaluation (default: balanced)')
    slide_parser.add_argument('--max-refinement-iterations', type=int, default=3,
                              help='Maximum number of refinement iterations for low-quality slides (default: 3)')
    
    # Research command (detailed research without slides)
    research_parser = subparsers.add_parser('research', help='Research functionality - both quick search and detailed analysis')
    research_parser.add_argument('topic', help='The topic to research')
    research_parser.add_argument('--depth', '-d', type=str, default='medium',
                               choices=['low', 'medium', 'high'],
                               help='Research depth (default: medium)')
    research_parser.add_argument('--output', '-o', type=str, help='Output file for research results')
    research_parser.add_argument('--format', '-f', type=str, default='json',
                               choices=['json', 'markdown', 'txt'],
                               help='Output format for research results (default: json)')
    research_parser.add_argument('--basic', '-b', action='store_true',
                               help='åŸºæœ¬çš„ãªæ¤œç´¢çµæœã®ã¿ã‚’è¡¨ç¤ºï¼ˆè©³ç´°åˆ†æãªã—ï¼‰')
    research_parser.add_argument('--results', '-r', type=int, default=10,
                               help='Number of search results to return (default: 10)')
    research_parser.add_argument('--json', '-j', action='store_true',
                               help='çµæœã‚’JSONå½¢å¼ã§æ¨™æº–å‡ºåŠ›ã«è¡¨ç¤º')
    research_parser.add_argument('--quiet', '-q', action='store_true',
                               help='ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›æ™‚ã«è©³ç´°ãªçµæœè¡¨ç¤ºã‚’æŠ‘åˆ¶ã™ã‚‹')
    research_parser.add_argument('--store', '-s', type=str, 
                               help='æ¤œç´¢çµæœã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã™ã‚‹ã‚­ãƒ¼åï¼ˆæ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰')
    research_parser.add_argument('--store-file', type=str, 
                               help='æ¤œç´¢çµæœã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹')
    research_parser.add_argument('--next-agent', type=str, choices=['outline', 'slides', 'template'],
                               help='æ¤œç´¢å¾Œã«è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆoutline, slides, templateãªã©ï¼‰')
    
    # JSON to slides command
    json_slides_parser = subparsers.add_parser('json-to-slides', help='Generate slides directly from a JSON file')
    json_slides_parser.add_argument('json_file', help='Path to the JSON file with research data')
    json_slides_parser.add_argument('--slides', '-s', type=int, default=5, 
                                  help='Number of slides to generate (default: 5)')
    json_slides_parser.add_argument('--style', type=str, default='professional',
                                  choices=['professional', 'modern', 'minimal', 'business'],
                                  help='Presentation style (default: professional)')
    json_slides_parser.add_argument('--output', '-o', type=str,
                                  help='Output HTML file or directory (default: temporary file)')
    json_slides_parser.add_argument('--open', '-b', action='store_true',
                                  help='Open the generated slides in a browser')
    
    # If no arguments are provided, show the help
    if len(sys.argv) == 1:
        parser.print_help()
        sys.exit(1)
    
    # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰æœ€åˆã®ã‚³ãƒãƒ³ãƒ‰éƒ¨åˆ†ã‚’å–å¾—
    command = None
    for arg in sys.argv[1:]:
        if not arg.startswith('-') and arg in ['slide', 'research', 'json-to-slides']:
            command = arg
            break
    
    if not command:
        parser.print_help()
        sys.exit(1)
    
    # parse_known_argsã‚’ä½¿ç”¨ã—ã¦ã€æœªçŸ¥ã®å¼•æ•°ã‚’ã‚¹ã‚­ãƒƒãƒ—
    args, unknown = parser.parse_known_args()
    
    # æœªçŸ¥ã®å¼•æ•°ãŒã‚ã‚Œã°è­¦å‘Šã‚’è¡¨ç¤º
    if unknown:
        cross_command_args = {
            'slide': [],
            'research': [],
            'json-to-slides': [],
        }
        
        # ã‚³ãƒãƒ³ãƒ‰ã¨äº’æ›æ€§ã®ãªã„å¼•æ•°ã‚’æ¤œå‡º
        if args.command in cross_command_args:
            ignored_args = []
            for arg in unknown:
                if any(cross_arg in arg for cross_arg in cross_command_args.get(args.command, [])):
                    ignored_args.append(arg)
            
            if ignored_args:
                print(f"âš ï¸ æ³¨æ„: '{args.command}'ã‚³ãƒãƒ³ãƒ‰ã§ã¯ä»¥ä¸‹ã®å¼•æ•°ã¯ç„¡è¦–ã•ã‚Œã¾ã™: {', '.join(ignored_args)}")
                if '--slides' in ' '.join(ignored_args) and args.command == 'slide':
                    print("ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ 'slide' ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„")
    
    return args

def generate_command(args: argparse.Namespace) -> None:
    """Handle the 'slide' command for slide generation"""
    try:
        # Set up logging
        log_file = setup_logging(args.topic)
        logger = logging.getLogger(__name__)
        
        # Start timer
        start_time = time.time()
        
        # Generate slides
        html_content = generate_slides_cli(
            topic=args.topic,
            slide_count=args.slides,
            style=args.style,
            depth=args.depth,
            output_file=args.output,
            use_orchestrator=args.orchestrator
        )
        
        # Display log file
        print(f"\nğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # Calculate and display elapsed time
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ ç”Ÿæˆæ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        
        print(f"\nğŸ‰ ã‚¹ãƒ©ã‚¤ãƒ‰ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼")
        
        # Open in browser if requested
        if args.open:
            # If output file was specified, use that path
            if args.output:
                output_path = Path(args.output)
                if output_path.is_dir():
                    # Use the topic as the filename
                    safe_topic = "".join(c if c.isalnum() else "_" for c in args.topic)
                    output_path = output_path / f"{safe_topic}.html"
                browser_path = output_path.absolute().as_uri()
            else:
                # Create a temporary file
                import tempfile
                temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.html')
                temp_path = Path(temp_file.name)
                with open(temp_path, 'w', encoding='utf-8') as f:
                    f.write(html_content)
                browser_path = temp_path.absolute().as_uri()
            
            # Open in browser
            print(f"ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’é–‹ã„ã¦ã„ã¾ã™...")
            try:
                webbrowser.open(browser_path)
                print(f"âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™")
            except Exception as e:
                print(f"âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                print(f"â„¹ï¸ æ‰‹å‹•ã§æ¬¡ã®URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«å…¥åŠ›ã—ã¦ãã ã•ã„: {browser_path}")
            
    except Exception as e:
        logger.error(f"âŒ ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {str(e)}")
        sys.exit(1)

def research_command(args: argparse.Namespace) -> None:
    """Handle the 'research' command for detailed research without slide generation"""
    try:
        # Set up logging
        log_file = setup_logging(args.topic)
        logger = logging.getLogger(__name__)
        
        print(f"ğŸ“ ãƒªã‚µãƒ¼ãƒãƒˆãƒ”ãƒƒã‚¯: {args.topic}")
        print(f"ğŸ“Š ãƒªã‚µãƒ¼ãƒæ·±åº¦: {args.depth}")
        if args.basic:
            print("ğŸ” ãƒ¢ãƒ¼ãƒ‰: åŸºæœ¬æ¤œç´¢ï¼ˆè©³ç´°åˆ†æãªã—ï¼‰")
        else:
            print("ğŸ” ãƒ¢ãƒ¼ãƒ‰: è©³ç´°ãƒªã‚µãƒ¼ãƒï¼ˆäºŒæ¬¡æ¤œç´¢ã¨è¦ç´„ã‚ã‚Šï¼‰")
        print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
        
        # Initialize the research agent
        from agents.research import ResearchAgent
        research_agent = ResearchAgent()
        
        # Start timer
        start_time = time.time()
        
        # å‡ºåŠ›æŠ‘åˆ¶ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå…¨å…±é€šå‡¦ç†ç”¨ï¼‰
        should_display_details = not (args.output and args.quiet)
        
        # ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜å·ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        def clean_markdown(text):
            if not text or not isinstance(text, str):
                return text
            # ** ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¤ªå­—ï¼‰ã®å‰Šé™¤
            cleaned = text.replace("**", "")
            # ãã®ä»–ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜å·ã‚’å¿…è¦ã«å¿œã˜ã¦å‰Šé™¤
            return cleaned
        
        # Perform basic search or comprehensive research based on flag
        if args.basic:
            # åŸºæœ¬æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
            logger.info(f"ğŸ” ãƒˆãƒ”ãƒƒã‚¯ã€Œ{args.topic}ã€ã®åŸºæœ¬æ¤œç´¢ã‚’é–‹å§‹ (æ·±ã•: {args.depth})")
            
            # æ—¥æœ¬èªãŒå«ã¾ã‚Œã‚‹å ´åˆã€è‹±èªã«ç¿»è¨³ã—ã¦ã‹ã‚‰æ¤œç´¢ã™ã‚‹
            search_query = args.topic
            is_japanese = any(ord(c) > 127 for c in args.topic)
            
            if is_japanese:
                try:
                    print("ğŸ”¤ æ—¥æœ¬èªã‚¯ã‚¨ãƒªã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚è‹±èªã«ç¿»è¨³ã—ã¦æ¤œç´¢ã—ã¾ã™...")
                    from openai import OpenAI
                    client = OpenAI()
                    
                    # ã‚¯ã‚¨ãƒªã‚’è‹±èªã«ç¿»è¨³
                    response = client.chat.completions.create(
                        model="gpt-3.5-turbo",
                        messages=[
                            {"role": "system", "content": "ã‚ãªãŸã¯ç¿»è¨³è€…ã§ã™ã€‚æ—¥æœ¬èªã‚’è‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚ç¿»è¨³ã®ã¿ã‚’å‡ºåŠ›ã—ã€ä½™è¨ˆãªèª¬æ˜ã¯ä¸è¦ã§ã™ã€‚"},
                            {"role": "user", "content": f"ä»¥ä¸‹ã‚’è‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„: {args.topic}"}
                        ]
                    )
                    
                    translated_query = response.choices[0].message.content.strip()
                    print(f"ğŸ”¤ ç¿»è¨³: ã€Œ{args.topic}ã€â†’ã€Œ{translated_query}ã€")
                    search_query = translated_query
                    
                except Exception as e:
                    logger.warning(f"âš ï¸ ç¿»è¨³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
                    print("âš ï¸ ç¿»è¨³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å…ƒã®ã‚¯ã‚¨ãƒªã§æ¤œç´¢ã‚’ç¶šè¡Œã—ã¾ã™ã€‚")
            
            try:
                # æ¤œç´¢ã‚’å®Ÿè¡Œ
                # è¤‡æ•°ã®ã‚¯ã‚¨ãƒªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”¨æ„
                search_queries = [search_query]
                
                # å…ƒã®ã‚¯ã‚¨ãƒªãŒæ—¥æœ¬èªã ã£ãŸå ´åˆã¯ã€ã‚ˆã‚Šæ±ç”¨çš„ãªæ¤œç´¢ã‚‚è©¦ã™
                if is_japanese:
                    # ã‚ˆã‚Šæ±ç”¨çš„ãªã‚¯ã‚¨ãƒªã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                    if "æœ€æ–°" in args.topic or "ãƒˆãƒ¬ãƒ³ãƒ‰" in args.topic:
                        search_queries.append("AI trends")
                        search_queries.append("AI latest developments")
                    elif "æ–¹æ³•" in args.topic or "ã‚„ã‚Šæ–¹" in args.topic:
                        search_queries.append("AI how to")
                        search_queries.append("AI methods")
                    elif "é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" in args.topic or "é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿" in args.topic:
                        search_queries.append("Quantum computing")
                        search_queries.append("Quantum computers")
                        if "å¿œç”¨" in args.topic or "æ´»ç”¨" in args.topic:
                            search_queries.append("Quantum computing applications")
                    elif "æ©Ÿæ¢°å­¦ç¿’" in args.topic or "æ·±å±¤å­¦ç¿’" in args.topic:
                        search_queries.append("Machine learning")
                        search_queries.append("Deep learning")
                    else:
                        # ä¸€èˆ¬çš„ãªä»£æ›¿ã‚¯ã‚¨ãƒª
                        # ã‚¯ã‚¨ãƒªã‚’ã‚ˆã‚Šå˜ç´”åŒ–ï¼šæœ€åˆã®2å˜èªç¨‹åº¦ã‚’æŠ½å‡º
                        simplified_query = " ".join(search_query.split()[:2])
                        search_queries.append(simplified_query)
                        search_queries.append(f"{search_query} guide")
                        search_queries.append(f"about {search_query}")
                        
                    # æœ€å¾Œã«å¸¸ã«åŸºæœ¬çš„ãªã‚¯ã‚¨ãƒªã‚’è¿½åŠ 
                    if "AI" in search_query:
                        search_queries.append("AI technology")
                    if "é‡å­" in args.topic:
                        search_queries.append("Quantum technology")
                
                # ãã‚Œä»¥å¤–ã®å ´åˆã‚‚ä»£æ›¿ã‚¯ã‚¨ãƒªã‚’è¿½åŠ 
                else:
                    # è‹±èªã‚¯ã‚¨ãƒªã®å ´åˆã®ä»£æ›¿æ¡ˆ
                    if "trends" in search_query.lower() or "latest" in search_query.lower():
                        search_queries.append("AI current developments")
                        search_queries.append("AI new technologies")
                    elif "how to" in search_query.lower() or "methods" in search_query.lower():
                        search_queries.append("AI techniques")
                        search_queries.append("AI methodologies")
                    else:
                        # ä¸€èˆ¬çš„ãªä»£æ›¿ã‚¯ã‚¨ãƒª
                        search_queries.append(f"{search_query} overview")
                        search_queries.append(f"{search_query} explained")
                
                # å„ã‚¯ã‚¨ãƒªã‚’é †ç•ªã«è©¦ã™
                search_results = []
                success_query = None
                
                for i, query in enumerate(search_queries):
                    if i > 0:
                        print(f"ğŸ”„ ä»£æ›¿ã‚¯ã‚¨ãƒªã‚’è©¦è¡Œä¸­ ({i}/{len(search_queries)-1}): ã€Œ{query}ã€")
                    
                    try:
                        results = research_agent.search_web(query, num_results=args.results, depth=args.depth)
                        if results and len(results) > 0:
                            search_results = results
                            success_query = query
                            break
                    except Exception as inner_e:
                        logger.warning(f"âš ï¸ ã‚¯ã‚¨ãƒªã€Œ{query}ã€ã§ã®æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: {str(inner_e)}")
                        continue
                
                # ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªãŒå¤±æ•—ã—ãŸå ´åˆ
                if not search_results or len(search_results) == 0:
                    print("âŒ ã™ã¹ã¦ã®æ¤œç´¢ã‚¯ã‚¨ãƒªãŒçµæœã‚’è¿”ã—ã¾ã›ã‚“ã§ã—ãŸã€‚")
                    print("\nğŸ’¡ ææ¡ˆ:")
                    print("- ã‚ˆã‚Šä¸€èˆ¬çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„")
                    print("- è‹±èªã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ (ä¾‹: 'AI trends' ãªã©)")
                    print("- æ¤œç´¢æ·±åº¦ã‚’ 'low' ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„")
                    raise Exception("æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å¤‰æ›´ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚")
                else:
                    if success_query != search_query:
                        print(f"âœ… ä»£æ›¿ã‚¯ã‚¨ãƒªã€Œ{success_query}ã€ã§æ¤œç´¢ã«æˆåŠŸã—ã¾ã—ãŸ")
                
                # Generate summaries for search results
                print(f"\nğŸ”„ æ¤œç´¢çµæœã®è¦ç´„ã‚’ç”Ÿæˆä¸­...")
                try:
                    summaries = summarize_search_results(search_results)
                except Exception as e:
                    logger.error(f"âŒ è¦ç´„å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                    print("âš ï¸ è¦ç´„ã®ç”Ÿæˆã«ä¸€éƒ¨å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ©ç”¨å¯èƒ½ãªæƒ…å ±ã®ã¿è¡¨ç¤ºã—ã¾ã™ã€‚")
                    # ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã§ã‚‚ç©ºã®è¾æ›¸ã‚’åˆæœŸåŒ–ã—ã¦å‡¦ç†ã‚’ç¶šè¡Œ
                    summaries = {}
                
                # çµæœã‚«ã‚¦ãƒ³ãƒˆ (æœ‰åŠ¹ãªURLã®ã¿)
                valid_results = [r for r in search_results if r.url_hash in summaries or not any(invalid_url in r.url for invalid_url in ["runsystem.vn"])]
                if not valid_results:
                    valid_results = search_results  # å…¨ã¦ãŒç„¡åŠ¹ãªå ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
                
                # çµæœã‚’è¡¨ç¤º
                print(f"\nâœ… æ¤œç´¢çµæœ: {len(valid_results)} ä»¶")
                
                if len(valid_results) == 0 and len(search_results) > 0:
                    print("âš ï¸ æœ‰åŠ¹ãªæ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€åŸæ–‡ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚")
                    valid_results = search_results[:3]  # æœ€åˆã®3ä»¶ã ã‘ã§ã‚‚è¡¨ç¤º
                
                # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã®ä¿¡é ¼æ€§è©•ä¾¡ã‚’è¡Œã†
                try:
                    research_agent = ResearchAgent()
                    valid_results = research_agent.evaluate_credibility(valid_results)
                    logger.info("âœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã®ä¿¡é ¼æ€§è©•ä¾¡ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ")
                except Exception as eval_err:
                    # è©³ç´°ãªã‚¨ãƒ©ãƒ¼ã¯debugãƒ¬ãƒ™ãƒ«ã§ã®ã¿ãƒ­ã‚°ã«è¨˜éŒ²
                    logger.debug(f"ä¿¡é ¼æ€§è©•ä¾¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(eval_err)}")
                    logger.warning("âš ï¸ ä¿¡é ¼æ€§è©•ä¾¡ã«ä¸€éƒ¨å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚åŸºæœ¬ã‚¹ã‚³ã‚¢ã‚’ä½¿ç”¨ã—ã¾ã™")
                    
                    # ã‚¹ã‚³ã‚¢ãŒã‚¼ãƒ­ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                    for result in valid_results:
                        if result.credibility_score == 0.0:
                            result.credibility_score = 0.5
                
                # å‡ºåŠ›æŠ‘åˆ¶ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                should_display_details = not (args.output and args.quiet)
                
                if should_display_details:
                    for i, result in enumerate(valid_results, 1):
                        print(f"\n{i}. {result.title}")
                        print(f"   URL: {result.url}")
                        print(f"   ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢: {result.credibility_score:.2f}")
                        
                        # Display the summary if available
                        summary = summaries.get(result.url_hash, "")
                        if summary:
                            # Format and display the summary with a separator line
                            print(f"   ğŸ“ è¦ç´„:")
                            # Wrap summary at ~80 chars for better display
                            import textwrap
                            wrapped_summary = textwrap.fill(summary, width=76)
                            for line in wrapped_summary.split('\n'):
                                print(f"      {line}")
                        
                        # Truncate snippet if too long
                        if not summary:  # Only show snippet if no summary available
                            snippet = result.snippet[:200] + "..." if len(result.snippet) > 200 else result.snippet
                            print(f"   {snippet}")
                
                # åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ï¼ˆå¿…è¦ãªå ´åˆï¼‰
                if args.output or args.json:
                    output_format = args.format.lower()
                    
                    # Import the ResearchResult class for compatibility
                    from agents.research import ResearchResult
                    
                    # Output the data using the same format as detailed research
                    if output_format == 'json':
                        import json
                        # Create a serializable dictionary with summaries
                        results_with_summaries = []
                        for result in valid_results:
                            result_dict = result.model_dump()
                            # Add summary from our generated summaries
                            summary_text = summaries.get(result.url_hash, "")
                            result_dict["summary"] = clean_markdown(summary_text)
                            # Also update content field for consistency with detailed mode
                            if not result_dict.get("content") and summaries.get(result.url_hash):
                                result_dict["content"] = clean_markdown(summary_text)
                                
                            # ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                            if result_dict["credibility_score"] == 0.0:
                                result_dict["credibility_score"] = 0.5
                                
                            results_with_summaries.append(result_dict)
                        
                        # JSONãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                        output_data = {
                            "topic": args.topic,
                            "search_query": success_query or search_query,
                            "summary": f"Basic search results for '{args.topic}'",
                            "primary_results": results_with_summaries,
                            "secondary_results": [],
                            "knowledge_gaps": []
                        }
                        
                        # --next-agent ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€
                        # --store ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã«ã‹ã‹ã‚ã‚‰ãšãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜
                        if args.next_agent:
                            # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®ã‚­ãƒ¼ã¯ã€--store ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å€¤ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ "research_result"
                            store_key = args.store if args.store else "research_result"
                            agent_data_store.set(store_key, output_data)
                            logger.info(f"âœ… æ¤œç´¢çµæœã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: {store_key})")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
                        if args.output:
                            with open(args.output, 'w', encoding='utf-8') as f:
                                json.dump(output_data, f, ensure_ascii=False, indent=2)
                        
                        # JSONå½¢å¼ã§æ¨™æº–å‡ºåŠ›
                        if args.json:
                            print("\nğŸ“‹ JSONãƒ‡ãƒ¼ã‚¿å‡ºåŠ›:")
                            print(json.dumps(output_data, ensure_ascii=False, indent=2))
                    elif output_format == 'markdown':
                        # Generate markdown format
                        markdown = f"# {args.topic} - Basic Search Results\n\n"
                        markdown += f"Simple search results for '{args.topic}'.\n\n"
                        if success_query and success_query != search_query:
                            markdown += f"*Note: Results obtained using the query: '{success_query}'*\n\n"
                        markdown += "## Search Results\n\n"
                        
                        for i, result in enumerate(valid_results):
                            markdown += f"{i+1}. [{result.title}]({result.url})\n"
                            summary = summaries.get(result.url_hash, "")
                            if summary:
                                markdown += f"   - **è¦ç´„**: {summary}\n"
                            markdown += f"   - {result.snippet}\n\n"
                        
                        with open(args.output, 'w', encoding='utf-8') as f:
                            f.write(markdown)
                            
                    else:  # txt format
                        # Generate plain text format
                        text = f"{args.topic} - Basic Search Results\n\n"
                        text += f"Simple search results for '{args.topic}'.\n\n"
                        if success_query and success_query != search_query:
                            text += f"Note: Results obtained using the query: '{success_query}'\n\n"
                        text += "Search Results:\n\n"
                        
                        for i, result in enumerate(valid_results):
                            text += f"{i+1}. {result.title}\n"
                            text += f"   URL: {result.url}\n"
                            summary = summaries.get(result.url_hash, "")
                            if summary:
                                text += f"   è¦ç´„: {summary}\n"
                            text += f"   {result.snippet}\n\n"
                        
                        with open(args.output, 'w', encoding='utf-8') as f:
                            f.write(text)
                    
                    # é‡è¤‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é˜²æ­¢ã®ãŸã‚ã€å€‹åˆ¥ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã¯ãªãã€ã“ã“ã§å…±é€šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    if args.output:
                        print(f"\nğŸ’¾ ãƒªã‚µãƒ¼ãƒçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: {args.output} (å½¢å¼: {output_format})")

                    # æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è¨­å®š - args.outputã®æ¡ä»¶ã‹ã‚‰å¤–ã«ç§»å‹•
                        if args.store:
                            # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¿½åŠ 
                            print(f"\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - store_key: {args.store}")
                            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - output_data type: {type(output_data)}")
                            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - output_data keys: {list(output_data.keys()) if isinstance(output_data, dict) else 'Not a dict'}")
                                # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜
                            agent_data_store.set(args.store, output_data)
                            print(f"\nğŸ”„ æ¤œç´¢çµæœã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: {args.store})")
                        # ä¿å­˜å¾Œã®ç¢ºèª
                        stored_data = agent_data_store.get(args.store)
                        print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - stored_data: {'å­˜åœ¨ã—ã¾ã™' if stored_data else 'å­˜åœ¨ã—ã¾ã›ã‚“'}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
                        if args.store_file:
                            # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
            except Exception as e:
                error_message = f"æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}"
                logger.error(f"âŒ {error_message}")
                print(f"âŒ å‡¦ç†ã‚’ä¸­æ­¢ã—ã¾ã™")
                raise Exception(error_message)
        else:
            # è©³ç´°ãƒªã‚µãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰ã®å ´åˆï¼ˆæ—¢å­˜ã®å®Ÿè£…ï¼‰
            try:
                logger.info(f"ğŸ” ãƒˆãƒ”ãƒƒã‚¯ã€Œ{args.topic}ã€ã®è©³ç´°èª¿æŸ»ã‚’é–‹å§‹ (æ·±ã•: {args.depth})")
                research_result = None  # Initialize variable to avoid scope issues
                
                # Execute the deep search
                research_result = research_agent.search_deep(args.topic, args.depth)
                
                # Generate summaries for primary search results
                if research_result.primary_results:
                    if should_display_details:
                        print(f"\nğŸ”„ æ¤œç´¢çµæœã®è¦ç´„ã‚’ç”Ÿæˆä¸­...")
                    summaries = summarize_search_results(research_result.primary_results)
                    
                    # Add the summaries to the research result for later use
                    for result in research_result.primary_results:
                        if result.url_hash in summaries:
                            result.content = summaries[result.url_hash]
                
                # ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0ã®çµæœã«å¯¾ã—ã¦å†è©•ä¾¡ã‚’è¡Œã†
                zero_score_results = [r for r in research_result.primary_results if r.credibility_score == 0.0]
                if zero_score_results:
                    logger.info(f"ğŸ§ ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0ã®çµæœ {len(zero_score_results)} ä»¶ã‚’å†è©•ä¾¡ã—ã¾ã™")
                    try:
                        updated_results = research_agent.evaluate_credibility(zero_score_results)
                        # çµæœã‚’å…ƒã®ãƒªã‚¹ãƒˆã«æˆ»ã™
                        result_map = {r.url: r for r in updated_results}
                        for i, result in enumerate(research_result.primary_results):
                            if result.url in result_map:
                                research_result.primary_results[i] = result_map[result.url]
                        logger.info(f"âœ… ä¿¡é ¼æ€§å†è©•ä¾¡ãŒå®Œäº†ã—ã¾ã—ãŸ")
                    except Exception as eval_err:
                        logger.error(f"âŒ ä¿¡é ¼æ€§å†è©•ä¾¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(eval_err)}")
                
                # Print the summary
                if should_display_details:
                    print("\nğŸ“‹ ãƒªã‚µãƒ¼ãƒã‚µãƒãƒªãƒ¼:")
                    if research_result.summary:
                        # Show the first 2000 characters of the summary with "..." if truncated
                        summary_preview = research_result.summary[:2000]
                        if len(research_result.summary) > 2000:
                            summary_preview += "...\n(ã‚µãƒãƒªãƒ¼ã¯çœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„)"
                        print(summary_preview)
                    else:
                        print("ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚")
                
                # Print research statistics
                if should_display_details:
                    print("\nğŸ“Š ãƒªã‚µãƒ¼ãƒçµ±è¨ˆ:")
                    print(f"  â€¢ ä¸»è¦æƒ…å ±æº: {len(research_result.primary_results)} ä»¶")
                    if research_result.primary_results:
                        # Show top 3 domains
                        domains = {}
                        for result in research_result.primary_results:
                            domain = result.domain
                            if domain not in domains:
                                domains[domain] = 0
                            domains[domain] += 1
                        
                        # Sort domains by count
                        sorted_domains = sorted(domains.items(), key=lambda x: x[1], reverse=True)
                        print("    ä¸»è¦ãƒ‰ãƒ¡ã‚¤ãƒ³:")
                        for domain, count in sorted_domains[:3]:
                            print(f"      - {domain}: {count} ä»¶")
                            
                        # Display top primary results with summaries
                        print("\nğŸ“š ä¸»è¦æƒ…å ±æºã¨è¦ç´„:")
                        for i, result in enumerate(research_result.primary_results[:5]):
                            print(f"\n{i+1}. {result.title}")
                            print(f"   URL: {result.url}")
                            print(f"   ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢: {result.credibility_score:.2f}")
                            
                            # Display content as summary if available
                            if result.content:
                                print(f"   ğŸ“ è¦ç´„:")
                                # Wrap summary at ~80 chars for better display
                                import textwrap
                                wrapped_summary = textwrap.fill(result.content, width=76)
                                for line in wrapped_summary.split('\n'):
                                    print(f"      {line}")
                            
                            # Display snippet
                            if not result.content:  # Only show snippet if no summary available
                                snippet = result.snippet[:200] + "..." if len(result.snippet) > 200 else result.snippet
                                print(f"   {snippet}")
                        
                        if len(research_result.primary_results) > 5:
                            print(f"\n... ã»ã‹ {len(research_result.primary_results) - 5} ä»¶ã®æƒ…å ±æºãŒã‚ã‚Šã¾ã™")
                    
                    print(f"  â€¢ è¿½åŠ æƒ…å ±æº: {len(research_result.secondary_results)} ä»¶")
                    
                    # Show knowledge gaps
                    if research_result.knowledge_gaps:
                        print("  â€¢ æƒ…å ±ã‚®ãƒ£ãƒƒãƒ—:")
                        for gap in research_result.knowledge_gaps[:5]:  # Show top 5
                            print(f"    - {gap}")
                        if len(research_result.knowledge_gaps) > 5:
                            print(f"      ... ã»ã‹ {len(research_result.knowledge_gaps) - 5} ä»¶")
                
                # Save results if output file specified
                if args.output or args.json:
                    output_format = args.format.lower()
                    
                    if output_format == 'json':
                        import json
                        # Create a serializable dictionary with summaries
                        primary_results_with_summaries = []
                        for result in research_result.primary_results:
                            result_dict = result.model_dump()
                            # Use content field as summary if available, otherwise use generated summary
                            if not result_dict.get("content") and result.url_hash in summaries:
                                content_text = summaries.get(result.url_hash)
                                result_dict["content"] = clean_markdown(content_text)
                            # Ensure summary field exists
                            if result.content:
                                result_dict["summary"] = clean_markdown(result.content)
                            elif result.url_hash in summaries:
                                summary_text = summaries.get(result.url_hash)
                                result_dict["summary"] = clean_markdown(summary_text)
                                
                            # ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                            if result_dict["credibility_score"] == 0.0:
                                result_dict["credibility_score"] = 0.5
                                
                            primary_results_with_summaries.append(result_dict)
                        
                        output_data = {
                            "topic": research_result.topic,
                            "summary": clean_markdown(research_result.summary),
                            "primary_results": primary_results_with_summaries,
                            "secondary_results": [result.model_dump() for result in research_result.secondary_results],
                            "knowledge_gaps": research_result.knowledge_gaps
                        }
                        
                        # --next-agent ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€
                        # --store ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã«ã‹ã‹ã‚ã‚‰ãšãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜
                        if args.next_agent:
                            # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®ã‚­ãƒ¼ã¯ã€--store ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å€¤ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ "research_result"
                            store_key = args.store if args.store else "research_result"
                            agent_data_store.set(store_key, output_data)
                            logger.info(f"âœ… æ¤œç´¢çµæœã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: {store_key})")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
                        if args.output:
                            with open(args.output, 'w', encoding='utf-8') as f:
                                json.dump(output_data, f, ensure_ascii=False, indent=2)
                        
                        # JSONå½¢å¼ã§æ¨™æº–å‡ºåŠ›
                        if args.json:
                            print("\nğŸ“‹ JSONãƒ‡ãƒ¼ã‚¿å‡ºåŠ›:")
                            print(json.dumps(output_data, ensure_ascii=False, indent=2))
                    elif output_format == 'markdown':
                        # Generate markdown format
                        markdown = f"# {research_result.topic} - Research Summary\n\n"
                        markdown += research_result.summary if research_result.summary else "No summary available."
                        markdown += "\n\n## Primary Sources\n\n"
                        
                        for i, result in enumerate(research_result.primary_results):
                            markdown += f"{i+1}. [{result.title}]({result.url})\n"
                            if result.content:  # Include summary if available
                                markdown += f"   - **è¦ç´„**: {result.content}\n"
                            markdown += f"   - {result.snippet}\n\n"
                        
                        markdown += "## Knowledge Gaps\n\n"
                        for gap in research_result.knowledge_gaps:
                            markdown += f"- {gap}\n"
                        
                        with open(args.output, 'w', encoding='utf-8') as f:
                            f.write(markdown)
                            
                    else:  # txt format
                        # Generate plain text format
                        text = f"{research_result.topic} - Research Summary\n\n"
                        text += research_result.summary if research_result.summary else "No summary available."
                        text += "\n\nPrimary Sources:\n\n"
                        
                        for i, result in enumerate(research_result.primary_results):
                            text += f"{i+1}. {result.title}\n"
                            text += f"   URL: {result.url}\n"
                            if result.content:  # Include summary if available
                                text += f"   è¦ç´„: {result.content}\n"
                            text += f"   {result.snippet}\n\n"
                        
                        text += "Knowledge Gaps:\n\n"
                        for gap in research_result.knowledge_gaps:
                            text += f"- {gap}\n"
                        
                        with open(args.output, 'w', encoding='utf-8') as f:
                            f.write(text)
                    
                    # é‡è¤‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é˜²æ­¢ã®ãŸã‚ã€å€‹åˆ¥ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã¯ãªãã€ã“ã“ã§å…±é€šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    if args.output:
                        print(f"\nğŸ’¾ ãƒªã‚µãƒ¼ãƒçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: {args.output} (å½¢å¼: {output_format})")

                    # æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è¨­å®š - args.outputã®æ¡ä»¶ã‹ã‚‰å¤–ã«ç§»å‹•
                        if args.store:
                            # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¿½åŠ 
                            print(f"\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - store_key: {args.store}")
                            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - output_data type: {type(output_data)}")
                            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - output_data keys: {list(output_data.keys()) if isinstance(output_data, dict) else 'Not a dict'}")
                                # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜
                            agent_data_store.set(args.store, output_data)
                            print(f"\nğŸ”„ æ¤œç´¢çµæœã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: {args.store})")
                        # ä¿å­˜å¾Œã®ç¢ºèª
                        stored_data = agent_data_store.get(args.store)
                        print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - stored_data: {'å­˜åœ¨ã—ã¾ã™' if stored_data else 'å­˜åœ¨ã—ã¾ã›ã‚“'}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
                        if args.store_file:
                            # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
            except Exception as e:
                error_message = f"è©³ç´°ãƒªã‚µãƒ¼ãƒã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}"
                logger.error(f"âŒ {error_message}")
                print(f"âŒ å‡¦ç†ã‚’ä¸­æ­¢ã—ã¾ã™")
                raise Exception(error_message)
        
        # æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œ
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
        
    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³çµæœã‚’è¡¨ç¤º
                        print("\nâœ… ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ:")
                        for i, section in enumerate(outline, 1):
                            print(f"\n{i}. {section.title}")
                            for point in section.points:
                                print(f"   â€¢ {point}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
                        agent_data_store.set("outline_result", outline)
                        print("\nğŸ”„ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: outline_result)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (ã‚­ãƒ¼: {store_key})")
                    print("ğŸ’¡ æ¤œç´¢çµæœã‚’å–å¾—ã™ã‚‹ã«ã¯å…ˆã«æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ä¾‹:")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --next-agent outline")
                    print("   ã¾ãŸã¯")
                    print(f"   python app.py research \"<ãƒˆãƒ”ãƒƒã‚¯>\" --store {store_key} --next-agent outline")
            
            elif args.next_agent == 'template':
                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚’å®Ÿè¡Œ
                outline = agent_data_store.get("outline_result")
                
                if outline:
                    try:
                        from agents.template_selector import select_template_for_presentation
                        
                        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
                        print("\nğŸ¨ ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠä¸­...")
                        print("åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: default, modern, professional, business, minimal")
                        template = select_template_for_presentation(args.topic, outline)
                        
                        # çµæœã‚’è¡¨ç¤º
                        print(f"   ã‚¹ã‚¿ã‚¤ãƒ«: {template.style}")
                        
                        # ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                        agent_data_store.set("selected_template", template)
                        print("\nğŸ”„ é¸æŠã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ä¿å­˜ã—ã¾ã—ãŸ (ã‚­ãƒ¼: selected_template)")
                        
                        # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å ´åˆ
                        if args.store_file:
                            agent_data_store.save_to_file(args.store_file)
                            print(f"\nğŸ’¾ æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: {args.store_file}")
                    
                    except Exception as e:
                        logger.error(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
                        print(f"âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
                else:
                    print("âŒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚")
            
            # ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åŒæ§˜ã«è¿½åŠ å¯èƒ½
        
        # Calculate and display elapsed time (å…±é€šå‡¦ç†)
        elapsed = time.time() - start_time
        minutes, seconds = divmod(elapsed, 60)
        print(f"\nâ±ï¸ å‡¦ç†æ™‚é–“: {int(minutes)}åˆ† {int(seconds)}ç§’")
        print(f"\nâœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“„ è©³ç´°ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {log_file}")
        
        # ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®æ¤œè¨¼
        print("\nğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢çŠ¶æ…‹")
        if args.store:
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - è¦æ±‚ã•ã‚ŒãŸã‚­ãƒ¼: {args.store}")
            stored_data = agent_data_store.get(args.store)
            print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å­˜åœ¨: {'Yes' if stored_data else 'No'}")
            if stored_data:
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿å‹: {type(stored_data)}")
                print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: {len(str(stored_data))} ãƒã‚¤ãƒˆ")
                if isinstance(stored_data, dict):
                    print(f"ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ± - ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼: {list(stored_data.keys())}")
        
        if args.next_agent:
            print(f"\nğŸ”„ æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™: {args.next_agent}")
            
            # å„ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®åˆ†å²
            if args.next_agent == 'outline':
                # æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                # store_keyã‚’å–å¾—ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                store_key = args.store if args.store else "research_result"
                research_data = agent_data_store.get(store_key)
                
                if research_data:
                    from agents.outline import generate_outline
                    try:
                        # ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯5
                        slide_count = 5
                        
                        # ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
                        print("\nğŸ“ æ¤œç´¢çµæœã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...")
                        outline = generate_outline(research_data, slide_count)
                        